@model GuanajuatoAdminUsuarios.Models.RegistroReciboPagoModel

<div>
    <h5>Registro de Recibo de pago</h5>

    @if (Model != null)
    {

        <p>Folio: @(Model.FolioInfraccion ?? "-")</p>
        <p>Monto Calificacion: @(Model.Monto.HasValue ? Model.Monto.ToString() : "-")</p>


    }
</div>

  <form id ="reciboPagoForm"class="row px-4 mb-4 align-items-end">
      @Html.HiddenFor(m=>m.IdInfraccion)

    <div class="col-12 col-md-6 col-lg-3">
        <div class="controlForm my-3">
            @(Html.Kendo().TextBoxFor(m=>m.ReciboPago)
                .Label(l => l.Content("Recibo:"))
                .Placeholder("Ingresa el número del recibo")
                .HtmlAttributes(new { style = "width: 100%" })
                )

        </div>
    </div>
    <div id="mensajeServicio" class="error-message" style="color:green"></div>
    <div id="mensajeError" class="success-message" style="color:red"></div>


    <div class="col-12 col-md-6 col-lg-3">
        <div class="controlButton my-3">
            <button type="button" onclick="comprobarRecibo($('#ReciboPago').val())" class='btnPrimary'>
                <h5 class="m-0"><i class='icon-data m-0'></i>&nbsp;&nbsp; <b>Comprobar Recibo</b></h5>
            </button>
        </div>
    </div>

    <div class="col-12 col-md-4 col-lg-3 col-xl-2">
        <div class="controlForm my-3">
            @(Html.Kendo().TextBoxFor(m=>m.Monto)
                .Label(l => l.Content("Monto:"))
                .Placeholder("monto Pagado")
                .HtmlAttributes(new { style = "width: 100%", @readonly = "readonly" })
                )

        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="controlForm my-3">
            <label>Fecha:</label>
            @(Html.Kendo().DatePickerFor(t => t.FechaPago)
                .Label(l => l.Content("Fecha de pago:"))
                .HtmlAttributes(new { style = "width: 100%", @readonly = "readonly" })
                )
        </div>
    </div>

    <div class="col-12 col-md-6 col-lg-6">
        <div class="controlForm my-3">
            @(Html.Kendo().TextBoxFor(m=>m.LugarPago)
                .Label(l => l.Content("Lugar de pago"))
                .Placeholder("Lugar de pago")
                .HtmlAttributes(new { style = "width: 100%", @readonly = "readonly" })
                )
        </div>
    </div>
</form>

    <div class="col-12 col-md-6 col-lg-4 col-xl-3">
    <div class="controlButton my-3" id="botnGuardar" style="display: none;" onclick="guardarReciboPago()">
            @(Html.Kendo().Button()
                .Name("GuardarPago")
            .HtmlAttributes(new { @class = "btnPrimary"}) // Establece el atributo disabled
            .Content("<h5 class=\"m-0\"><b>Guardar</b></h5>"))
        </div>

    </div>
<script>
    function guardarReciboPago() {
        $.ajax({
            url: '/RegistroReciboPago/GuardarReciboPago',
            type: 'POST',
            data: {
                IdInfraccion: $("#IdInfraccion").val(),
                ReciboPago: $("#ReciboPago").val(),
                Monto: $("#Monto").val(),
                FechaPago: $("#FechaPago").val(),
                LugarPago: $("#LugarPago").val()
            },
            success: function (result) {
                sitteg_success("Información guardada correctamente ");
                $('#modalComprobacion').modal('hide');

            },
            error: function (error) {
                sitteg_warning("!Sucedio un error, intente mas tarde...");
            }
        });
    }

    function comprobarRecibo(reciboValue) {

        $.ajax({
            url: '/RegistroReciboPago/ConsultarDocumento', 
            type: 'POST', 
            data: { recibo: reciboValue }, 
            success: function (response) {
                console.log('Respuesta del servidor:', response);

                var wType = response.MT_ConsultarDocumento_res.result.WTYPE;
                var wMessage = response.MT_ConsultarDocumento_res.result.WMESSAGE;
                if (wType === "E") {
                    $('#mensajeError').text(wMessage);
                } else if (wType === "S") {
                    $('#mensajeError').text("");
                    $('#mensajeServicio').text(wMessage);
                    document.getElementById("botnGuardar").style.display = "block";
                    var fechaPago = response.MT_ConsultarDocumento_res.result.FECHA_PAGO;
                    var importe = response.MT_ConsultarDocumento_res.result.IMPORTE;


                    $('#FechaPago').data("kendoDatePicker").value(new Date(fechaPago));
                    $('#Monto').data("kendoTextBox").value(importe);
                }
            },
            error: function (response) {
                console.error('Error en la llamada AJAX:', response);
            }
        });
    }



</script>